name: Manual tests for homework

on:
  push:
    branches-ignore: main
  pull_request:
    branches-ignore: main

build:
  before_install:
    - pip install ansible ansible-lint

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout this repo
      uses: actions/checkout@v2
      with:
        ref: ${{ github.ref }}

    - name: Show current directory and files
      run: pwd && ls -l

    - name: Check packer templates
      run: find packer/ ! -name "variables.json" -a ! -name "key.json" -a -name "*.json" -type f -print0 | xargs -0 -n1 packer validate -syntax-only

    #- name: Check terraform stage templates
    #  run: cd terraform/stage/ && terraform init && terraform validate

    - name: Check ansible playbooks
      run: cd ansible && ansible-lint playbooks/*
